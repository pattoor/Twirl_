Morph subclass: #Ficha	instanceVariableNames: 'esBlanco'	classVariableNames: ''	package: 'twirl'!!Ficha methodsFor: 'Visuals' stamp: 'Ulises 11/27/2025 12:16'!normalizarBorde    self borderColor: Color black.    self borderWidth: 1.! !!Ficha methodsFor: 'Visuals' stamp: 'Ulises 11/27/2025 12:16'!marcarSugerencia    self borderColor: Color red.    self borderWidth: 4.! !!Ficha methodsFor: 'Visuals' stamp: 'fran 11/20/2025 17:02'!cambioColor    esBlanco        ifTrue: [ self color: Color white ]        ifFalse: [ self color: Color darkGray]! !!Ficha methodsFor: 'accessing' stamp: 'fran 11/20/2025 16:47'!esBlanco:unValor	esBlanco:=unValor.! !!Ficha methodsFor: 'accessing' stamp: 'fran 11/10/2025 16:50'!esBlanco	^esBlanco! !!Ficha methodsFor: 'actions' stamp: 'fran 11/20/2025 17:05'!cambio    esBlanco := esBlanco not.    self cambioColor.! !!Ficha methodsFor: 'initialization' stamp: 'Ulises 11/28/2025 13:56'!initialize    super initialize.    self extent: 50@50.        self normalizarBorde.         esBlanco := false.    self cambioColor.! !Morph subclass: #JuegoTwirl	instanceVariableNames: 'tablero txtReloj txtMovimientos tiempoInicio'	classVariableNames: ''	package: 'twirl'!!JuegoTwirl methodsFor: 'stepping and presenter' stamp: 'yyoyoyo 11/29/2025 18:23'!step	| segundosPasados tiempoRestante |	segundosPasados := Time now asSeconds - tiempoInicio asSeconds.	tiempoRestante := 60 - segundosPasados.	txtReloj contents: 'Tiempo: ' , tiempoRestante asString , 's'.	txtMovimientos contents:		'Movimientos: ' , tablero cantMov asString.	txtReloj position:		self right - txtReloj width - 15 @ txtReloj position y.	txtMovimientos position:		self right - txtMovimientos width - 15 @ txtMovimientos position y.	tiempoRestante <= 0 ifFalse: [ ^ self ].	tablero desordenar.	"Reiniciar el reloj para el siguiente minuto"	tiempoInicio := Time now.	"Actualizar para que no muestre 0s o -1s"	txtReloj contents: 'Tiempo: 60s'! !!JuegoTwirl methodsFor: 'stepping and presenter' stamp: 'dasdasd 11/28/2025 22:20'!stepTime    ^ 500! !!JuegoTwirl methodsFor: 'initialization' stamp: 'fran 12/4/2025 14:23'!initialize: unNumero    | tituloMorph botonSalida botonResolver botonAtras botonAdelante colorBotones anchoVentana altoVentana yControles |    colorBotones := Color orange.		"CREAR TABLERO"	 self color: (Color gray alpha: 0.9).     self borderWidth: 1; borderColor: Color black.    tablero := Tablero new.    tablero configurarConTamanio: unNumero. 	 tablero juego:self.        "CREAR INTERFAZ "    tituloMorph := StringMorph contents: 'TWIRL' font: (StrikeFont familyName: 'DejaVu Sans' size: 24).    tituloMorph color: Color white.    txtReloj := StringMorph contents: 'Tiempo: 60s'. txtReloj color: Color white.    txtMovimientos := StringMorph contents: 'Movimientos: 0'. txtMovimientos color: Color white.        botonSalida := Salir new. botonSalida tablero: tablero; color: colorBotones.    botonResolver := Resolver new. botonResolver tablero: tablero; color: colorBotones.    botonAtras := SimpleButtonMorph new. botonAtras label: '<'; target: tablero; actionSelector: #deshacer; color: colorBotones.    botonAdelante := SimpleButtonMorph new. botonAdelante label: '>'; target: tablero; actionSelector: #rehacer; color: colorBotones.        self addMorph: tituloMorph. self addMorph: tablero.    self addMorph: botonSalida. self addMorph: botonResolver.    self addMorph: botonAtras. self addMorph: botonAdelante.    self addMorph: txtReloj. self addMorph: txtMovimientos.    "POSICIONAMIENTO"    altoVentana := tablero height + 130.    anchoVentana := (tablero width + 40) max: 350.    self extent: anchoVentana @ altoVentana.        tituloMorph position: (self width // 2 - (tituloMorph width // 2)) @ 5.    yControles := tituloMorph bottom + 5.    botonResolver position: 15 @ yControles.    botonAtras position: (botonResolver right + 5) @ yControles.    botonAdelante position: (botonAtras right + 5) @ yControles.    txtMovimientos position: (self width - txtMovimientos width - 15) @ (yControles + 5).    txtReloj position: (self width - txtReloj width - 15) @ (txtMovimientos top - 15).    tablero position: (self width // 2 - (tablero width // 2)) @ (yControles + 40).    botonSalida position: (self width // 2 - (botonSalida width // 2)) @ (self height - botonSalida height - 10).    "RELOJ"	tiempoInicio:= Time now.    self startStepping.! !!JuegoTwirl methodsFor: 'finalization' stamp: 'fran 12/4/2025 14:45'!notificarVictoria	|sel|		self stopStepping.		sel:= UIManager default		chooseFrom: #('Jugar de nuevo' Salir)		title: '¡Felicidades!! Has ganado.'.	"segun sel hacemos:.."    sel = 1 ifTrue: [         "cerramos esta ventana y abrimos una nueva"		  self delete.         JuegoTwirl abrir.     ].        sel = 2 ifTrue: [         "solo cerramos esta ventana"        self delete.     ].        "si se cierra la ventana de opcion sin elegir también cerramos para que no quede el reloj colgado"    (sel isNil or: [sel = 0]) ifTrue: [ self delete ].! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!JuegoTwirl class	instanceVariableNames: ''!!JuegoTwirl class methodsFor: 'instance creation' stamp: 'yyoyoyo 11/29/2025 18:38'!abrir    | tamElegido nuevoJuego |        " Pedimos el tamaño"    tamElegido := Tablero solicitarTamanio.            (tamElegido isNil or: [ tamElegido = 0 ]) ifTrue: [ ^ self ].         nuevoJuego := self new.    nuevoJuego initialize: tamElegido.           nuevoJuego position: (self currentWorld center - (nuevoJuego extent // 2)).    nuevoJuego openInWorld.        ^ nuevoJuego! !SimpleButtonMorph subclass: #Resolver	instanceVariableNames: 'tablero'	classVariableNames: ''	package: 'twirl'!!Resolver methodsFor: 'initialize' stamp: 'yyoyoyo 11/29/2025 18:22'!initialize    super initialize.    self extent: 70@20.    self label: 'Resolver'.    self target: self.    self actionSelector: #resolver.! !!Resolver methodsFor: 'accessing' stamp: 'Ulises 11/27/2025 12:14'!tablero: unTablero    tablero := unTablero.! !!Resolver methodsFor: 'actions' stamp: 'Ulises 11/27/2025 12:15'!resolver    tablero resolverJuego.! !SimpleButtonMorph subclass: #Salir	instanceVariableNames: 'tablero'	classVariableNames: ''	package: 'twirl'!!Salir methodsFor: 'accessing' stamp: 'lauk 11/24/2025 12:04'!tablero: unTablero    tablero := unTablero.! !!Salir methodsFor: 'accessing' stamp: 'sadasd 11/28/2025 18:54'!salir    tablero owner delete.! !!Salir methodsFor: 'initialize' stamp: 'lauk 11/24/2025 12:04'!initialize    super initialize.    self extent: 50@20.    self label: 'Salir'.    self target: self.    self actionSelector: #salir.! !Morph subclass: #Tablero	instanceVariableNames: 'fichas tamanio historialDeshacer historialRehacer cantMov juego termino'	classVariableNames: ''	package: 'twirl'!!Tablero methodsFor: 'accessing' stamp: 'dasdasd 11/28/2025 22:19'!cantMov    ^ cantMov! !!Tablero methodsFor: 'accessing' stamp: 'fran 12/4/2025 14:15'!juego:unJuego	juego:=unJuego.! !!Tablero methodsFor: 'event handling' stamp: 'fran 12/4/2025 14:38'!handlesMouseDown: unEvento    ^ termino not.! !!Tablero methodsFor: 'event handling' stamp: 'lauk 11/24/2025 11:42'!mouseDown: unEvento    "posEnTablero -> contiene la posicion del clic dentro del tablero"    | posEnTablero f c |    posEnTablero := unEvento position - self position.     "Convertimos las posiciones del clic a numeros reales"    c := (posEnTablero x // 50) + 1.     f := (posEnTablero y // 50) + 1.     "Si el clic es válido lo procesamos"    ((f between: 1 and: tamanio) and: [ c between: 1 and: tamanio ]) "<- Usar tamanio"        ifTrue: [ self procesarClicEn: f y: c ] ! !!Tablero methodsFor: 'initialization' stamp: 'yyoyoyo 11/29/2025 18:34'!configurarConTamanio: unNumero    tamanio := unNumero.    self extent: (tamanio * 50) @ (tamanio * 50).    self color: Color lightGray.    self crearFichas.! !!Tablero methodsFor: 'initialization' stamp: 'fran 12/4/2025 14:38'!initialize    super initialize.        "Memorias"    historialDeshacer := OrderedCollection new.    historialRehacer := OrderedCollection new.	termino := false.	 cantMov := 0.    ! !!Tablero methodsFor: 'private' stamp: 'yyoyoyo 11/29/2025 18:18'!ejecutarSiValidoF: f c: c en: unBloque    "Verifica los límites. Si es válido, ejecuta argumento"       ((f between: 1 and: tamanio) and: [ c between: 1 and: tamanio ])         ifTrue: [ unBloque value ].! !!Tablero methodsFor: 'private' stamp: 'sadasd 11/28/2025 19:49'!obtenerCoordenadas: f y: c    "Devuelve una colección de Puntos con las coordenadas de la cruz (centro y vecinos)"    ^ {         f@c .           "Centro"        (f-1)@c .       "Arriba"        (f+1)@c .       "Abajo"        f@(c-1) .       "Izquierda"        f@(c+1)         "Derecha"    }.! !!Tablero methodsFor: 'actions' stamp: 'yyoyoyo 11/29/2025 18:21'!procesarClicEn: f y: c    | hayAyudaActiva coordenadas |        "Guardamos el movimiento actual y limpiamos el futuro"    historialDeshacer add: (f @ c).    historialRehacer removeAll.    cantMov := cantMov + 1.    "Lógica Visual "    hayAyudaActiva := false.    fichas do: [:fila | fila do: [:ficha |        ficha borderColor = Color red ifTrue: [ hayAyudaActiva := true ]    ]].        ((fichas at: f) at: c) normalizarBorde.          coordenadas := self obtenerCoordenadas: f y: c.    coordenadas do: [:p |        self ejecutarSiValidoF: p x c: p y en: [            ((fichas at: p x) at: p y) cambio        ].    ].    "Verificar victoria y Ayudas"    self verificarColor.    hayAyudaActiva ifTrue: [ self resolverJuego ].! !!Tablero methodsFor: 'actions' stamp: 'fran 11/30/2025 22:19'!crearFichas    | ficha |    fichas := Array new: tamanio.        "Crear tablero visual"    1 to: tamanio do: [:f |        fichas at: f put: (Array new: tamanio).        1 to: tamanio do: [:c |            ficha := Ficha new.            ficha position: ((c - 1) * 50) @ ((f - 1) * 50).            self addMorph: ficha.            (fichas at: f) at: c put: ficha.        ].    ].    self desordenar.    " Limpiamos la memoria para que el juego empiece 'limpio'"    historialDeshacer removeAll.    historialRehacer removeAll.	 cantMov := 0.! !!Tablero methodsFor: 'actions' stamp: 'yyoyoyo 11/29/2025 18:16'!deshacer    | ultimaCoord coordenadas |        "Si no hay nada para deshacer, no hacemos nada"    historialDeshacer isEmpty ifTrue: [ ^self ].        "Sacamos el último movimiento y lo pasamos al historial de rehacer"    ultimaCoord := historialDeshacer removeLast.    historialRehacer add: ultimaCoord.        "Descontamos el movimiento"    cantMov := (cantMov - 1) max: 0.        coordenadas := self obtenerCoordenadas: ultimaCoord x y: ultimaCoord y.    coordenadas do: [:p |        self ejecutarSiValidoF: p x c: p y en: [            ((fichas at: p x) at: p y) cambio        ].    ].! !!Tablero methodsFor: 'actions' stamp: 'yyoyoyo 11/29/2025 18:19'!intentarSolucionConMascara: mascaraInicial    | copiaTablero clicsRealizados |        "Copia el estado actual de las fichas"    copiaTablero := (1 to: tamanio) collect: [:f |         (1 to: tamanio) collect: [:c | ((fichas at: f) at: c) esBlanco ]     ].        clicsRealizados := (1 to: tamanio) collect: [:i | Array new: tamanio withAll: false].    "Aplica los clics de prueba en la primera fila"    1 to: tamanio do: [:c |        (mascaraInicial bitAnd: (1 bitShift: (c - 1))) > 0 ifTrue: [            (clicsRealizados at: 1) at: c put: true.            self simularClicEn: 1 y: c sobre: copiaTablero.        ]    ].    "si una luz está apagada en la fila F, clica en F+1"    1 to: (tamanio - 1) do: [:f |        1 to: tamanio do: [:c |            ((copiaTablero at: f) at: c) ifFalse: [                 (clicsRealizados at: (f + 1)) at: c put: true.                self simularClicEn: (f + 1) y: c sobre: copiaTablero.            ]        ]    ].    "Verifica si la última fila quedó resuelta"    ((copiaTablero at: tamanio) allSatisfy: [:val | val = true])         ifTrue: [ ^ clicsRealizados ]        ifFalse: [ ^ nil ].! !!Tablero methodsFor: 'actions' stamp: 'sadasd 11/28/2025 19:12'!resolverJuego    | solucion |    fichas do: [:fila | fila do: [:ficha | ficha normalizarBorde]].        "Prueba todas las combinaciones posibles de la primera fila (2 elevado a N)"    0 to: ((1 bitShift: tamanio) - 1) do: [:mascara |        solucion := self intentarSolucionConMascara: mascara.        solucion ifNotNil: [             self aplicarSolucionVisual: solucion.            ^ self         ].    ].! !!Tablero methodsFor: 'actions' stamp: 'yyoyoyo 11/29/2025 18:18'!desordenar    | randF randC coordenadas estaResuelto |    "Simulamos clics aleatorios"    (1 to: 20) atRandom timesRepeat: [        randF := tamanio atRandom.        randC := tamanio atRandom.          coordenadas := self obtenerCoordenadas: randF y: randC.        coordenadas do: [:p |            self ejecutarSiValidoF: p x c: p y en: [                ((fichas at: p x) at: p y) cambio            ].        ].    ].    "Comprobamos victoria manualmente"    estaResuelto := true.    fichas do: [:fila |         fila do: [:ficha |             ficha esBlanco ifFalse: [ estaResuelto := false ]         ]    ].    "Decisión Recursiva"    estaResuelto         ifTrue: [             "Si por azar quedó resuelto, reiniciamos el proceso recursivamente"            ^ self desordenar         ]        ifFalse: [             "Si quedó mezclado correctamente, limpiamos la memoria"            historialDeshacer removeAll.            historialRehacer removeAll.            cantMov := 0.        ].! !!Tablero methodsFor: 'actions' stamp: 'Ulises 11/27/2025 12:18'!aplicarSolucionVisual: matrizSolucion    1 to: tamanio do: [:f |        1 to: tamanio do: [:c |            ((matrizSolucion at: f) at: c) ifTrue: [                ((fichas at: f) at: c) marcarSugerencia.            ]        ]    ].! !!Tablero methodsFor: 'actions' stamp: 'sadasd 11/28/2025 20:07'!simularClicEn: f y: c sobre: unaMatriz    | coordenadas |        coordenadas := self obtenerCoordenadas: f y: c.        coordenadas do: [:p |        self ejecutarSiValidoF: p x c: p y en: [            | valorActual |            valorActual := (unaMatriz at: p x) at: p y.            (unaMatriz at: p x) at: p y put: valorActual not.        ].    ].! !!Tablero methodsFor: 'actions' stamp: 'fran 12/4/2025 14:39'!verificarColor    "Verifica si todas las fichas estan blancas (todas las fichas en true),     Si encuentra ficha gris devuelve false"    fichas do: [:f |        f do: [:ficha |            ficha esBlanco                 ifFalse: [ ^ false ]        ]    ].	 termino:=true.    juego notificarVictoria.    ^ true! !!Tablero methodsFor: 'actions' stamp: 'yyoyoyo 11/29/2025 18:21'!rehacer    | proximaCoord coordenadas |        "Si no hay nada para rehacer, salimos"    historialRehacer isEmpty ifTrue: [ ^self ].        "Sacamos del historial de rehacer y lo devolvemos al de deshacer"    proximaCoord := historialRehacer removeLast.    historialDeshacer add: proximaCoord.        "Sumamos el movimiento nuevamente"    cantMov := cantMov + 1.            coordenadas := self obtenerCoordenadas: proximaCoord x y: proximaCoord y.    coordenadas do: [:p |        self ejecutarSiValidoF: p x c: p y en: [            ((fichas at: p x) at: p y) cambio        ].    ].! !"-- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- "!Tablero class	instanceVariableNames: ''!!Tablero class methodsFor: 'instance creation' stamp: 'fran 11/29/2025 17:23'!solicitarTamanio    "Muestra el menú una sola vez. Si cancela, devuelve nil o 0."    ^ UIManager default         chooseFrom: #('Tablero de 3x3' 'Tablero de 4x4' 'Tablero de 5x5')         values: #(3 4 5)               title: 'Bienvenido a TWIRL - Elige dificultad'! !